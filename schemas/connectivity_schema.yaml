id: https://brain-connects.org/ic3-common-connectivity-schema
name: connectivity_schema
prefixes:
  linkml: https://w3id.org/linkml/
  schema: http://schema.org/
  skos: http://www.w3.org/2004/02/skos/core#
  cc: https://brain-connects.org/cc/
imports:
  - linkml:types
default_prefix: cc
default_range: string

types:
  Probability:
    base: float
    minimum_value: 0.0
    maximum_value: 1.0
  Timestamp:
    base: datetime

classes:
  DataSet:
    description: A collection of DataItems (e.g., all neurons from a study, all barcoded detections in a volume).
    slots:
      - id
      - label
      - publication
      - modality
  DataItem:
    description: An individual datum (e.g., neuron reconstruction, barcoded detection, injection experiment).
    slots:
      - id
      - label
      - dataset
    slot_usage:
      dataset:
        range: DataSet
        multivalued: false
        required: true
  AlgorithmRun:
    description: Metadata about a single execution of a clustering algorithm.
    slots:
      - id
      - algorithm_name
      - algorithm_version
      - parameters_json
      - run_timestamp
      - input_dataset
      - produced_hierarchies
    slot_usage:
      produced_hierarchies:
        range: ClusterHierarchy
        multivalued: true
        inlined: true

  ClusterHierarchy:
    description: A complete clustering result (tree or DAG) from one algorithm run.
    slots:
      - id
      - label
      - run
      - root
      - clusters
    slot_usage:
      run:
        range: AlgorithmRun
      clusters:
        range: Cluster
        multivalued: true
        inlined: true
      root:
        range: Cluster

  Cluster:
    description: A node (cluster) in a hierarchical clustering structure.
    slots:
      - id
      - label
      - parent
      - children
      - level
      - size
      - centroid_values
      - score
      - distance_to_parent
      - members
    slot_usage:
      parent:
        range: Cluster
        slot_uri: skos:broader
      children:
        range: Cluster
        multivalued: true
        inlined: true
        slot_uri: skos:narrower
      members:
        range: ClusterMembership
        multivalued: true
        inlined: true
      centroid_values:
        multivalued: true
        range: float
      level:
        range: integer
      size:
        range: integer
      distance_to_parent:
        range: float
      score:
        range: float

  ClusterMembership:
    description: Association linking a DataItem to a Cluster, with optional soft membership or distance metrics.
    slots:
      - item
      - cluster
      - membership_score
      - membership_probability
      - distance
    slot_usage:
      membership_probability:
        range: Probability
      membership_score:
        range: float
      distance:
        range: float

  BrainRegion:
    description: A brain region (node) in the common coordinate framework hierarchy.
    slots:
      - id
      - label
      - parent_region
      - child_regions
      - acronym
      - ontology_id
    slot_usage:
      parent_region:
        range: BrainRegion
        slot_uri: skos:broader
      child_regions:
        range: BrainRegion
        multivalued: true
        inlined: true
        slot_uri: skos:narrower
      ontology_id:
        description: External ontology reference (e.g., UBERON or other atlas ID)

  ProjectionMeasurementSet:
    description: Set of projection measurement values for one DataItem across multiple BrainRegions for a single measurement type.
    slots:
      - id
      - data_item
      - measurement_type
      - modality
      - values
      - target_regions
      - unit
    slot_usage:
      data_item:
        range: DataItem
        required: true
      measurement_type:
        range: MeasurementType
        required: true
      modality:
        range: Modality
      values:
        multivalued: true
        range: float
        description: Numeric values aligned positionally with target_regions.
      target_regions:
        multivalued: true
        range: BrainRegion
        inlined: false
        description: Ordered list of brain regions corresponding to the values vector.
      unit:
        range: Unit

  ProjectionMeasurementMatrix:
    description: Aggregated projection measurements for a cohort (e.g., all cells) for a single measurement type.
    slots:
      - id
      - measurement_type
      - modality
      - region_index
      - data_item_index
      - values
      - unit
    slot_usage:
      measurement_type:
        range: MeasurementType
      modality:
        range: Modality
      region_index:
        multivalued: true
        range: BrainRegion
        inlined: false
        description: Ordered regions defining columns (or rows) of the matrix.
      data_item_index:
        multivalued: true
        range: DataItem
        inlined: false
        description: Ordered data items defining rows (or columns) of the matrix.
      values:
        multivalued: true
        range: float
        description: Flattened matrix values in row-major order (data_item_index x region_index).
      unit:
        range: Unit

  MeasurementTypeMetadata:
    description: Metadata about a measurement type including modality specificity and description.
    slots:
      - id
      - label
      - modality
      - description_text
      - default_unit
    slot_usage:
      modality:
        range: Modality
      default_unit:
        range: Unit

enums:
  Modality:
    permissible_values:
      BARCODED:
        description: Barcoded projection mapping methods (e.g., MAPseq, BARseq) producing molecule detection counts.
      MORPHOLOGY:
        description: Morphological reconstructions providing structural projection features.
      TRACER:
        description: Traditional tracer experiments.
      OTHER:
        description: Other modality.
  MeasurementType:
    description: Types of projection-related measurements. Extendable per modality.
    permissible_values:
      DETECTIONS:
        description: Count of detected RNA/barcode molecules in a region (barcoded modalities).
      NUMBER_OF_TIPS:
        description: Number of axonal terminal tips reconstructed in a region (morphology derived metric).
      MICRONS_OF_AXON:
        description: Microns of axon contained in a region (morphology derived metric).
      SIGNAL_INTENSITY:
        description: General normalized signal intensity (e.g., tracer fluorescence).
  Unit:
    permissible_values:
      COUNT:
        description: Plain count unit.
      MICRONS:
        description: Micrometers length measurement.
      ARBITRARY_UNIT:
        description: Unspecified normalized unit.
      NONE:
        description: Dimensionless.

slots:
  id:
    identifier: true
    description: Unique identifier within the class context.
    type: string
  label:
    required: true
    description: A human-readable name or title. 
  modality:
    description: Source modality for the data item (if relevant).
  algorithm_name:
    required: true
  algorithm_version:
    required: false
  parameters_json:
    description: JSON serialization of algorithm parameters.
  run_timestamp:
    range: Timestamp
  input_dataset:
    description: Identifier for input dataset.
  produced_hierarchies:
    description: Hierarchies produced in this run.
  run:
    description: The AlgorithmRun producing this hierarchy.
  root:
    description: The root cluster of the hierarchy.
  clusters:
    description: All clusters in the hierarchy.
  parent:
    description: Direct parent cluster (omit for root).
  children:
    description: Child clusters.
  level:
    description: Depth (0=root).
  size:
    description: Number of data items (direct members or total; clarify convention).
  centroid_values:
    description: Numeric centroid vector (ordered feature list).
  score:
    description: Cluster quality metric (e.g., silhouette).
  distance_to_parent:
    description: Distance metric to parent centroid.
  members:
    description: Membership associations.
  item:
    range: DataItem
  cluster:
    range: Cluster
  membership_score:
    description: Algorithm-defined membership strength.
  membership_probability:
    description: Normalized probability of membership.
  distance:
    description: Distance between item and cluster centroid.
  publication:
    description: Reference to publication describing the dataset.
  parent_region:
    description: Reference to broader brain region.
  child_regions:
    description: Narrower brain regions nested under this region.
  acronym:
    description: Short region acronym.
  ontology_id:
    description: External ontology identifier (e.g., UBERON:xxxx).
  data_item:
    description: The DataItem for which projection measurements are reported.
  measurement_type:
    description: The specific projection measurement type (enum) for this set.
  region_index:
    description: Ordered list of regions indexing a matrix or values vector.
  data_item_index:
    description: Ordered list of data items indexing a matrix.
  values:
    description: Numeric data values; interpretation depends on measurement_type.
  target_regions:
    description: Regions corresponding to each value in a ProjectionMeasurementSet.
  unit:
    description: Unit of measure for the values.
  description_text:
    description: Free-text description for measurement type metadata.
  default_unit:
    description: Default unit recommended for this measurement type.